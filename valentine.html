<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For Jo üíå</title>

<style>
  :root{
    --bg1:#ffdde1;
    --bg2:#ee9ca7;
    --card:rgba(255,255,255,.88);
    --shadow:0 20px 60px rgba(0,0,0,.15);
    --text:#111827;
  }

  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background: radial-gradient(circle at 20% 20%, var(--bg1), var(--bg2));
    overflow:hidden;
    color:var(--text);
  }

  /* full-screen screen containers */
  .screen{
    position:fixed;
    inset:0;
    display:grid;
    place-items:center;
    padding:24px;
    transition: opacity .45s ease, transform .45s ease;
  }
  .hidden{
    opacity:0;
    pointer-events:none;
    transform: scale(.98);
  }

  .card{
    width:min(820px, 94vw);
    background:var(--card);
    border-radius:24px;
    padding:40px 28px;
    box-shadow:var(--shadow);
    backdrop-filter: blur(10px);
    text-align:center;
    position:relative;
  }

  h1{
    margin:0 0 12px;
    font-size:clamp(28px,4.2vw,48px);
    line-height:1.12;
    letter-spacing:-.02em;
  }
  .subhead{
    margin:0 0 22px;
    opacity:.82;
    font-size:16px;
  }

  .btnRow{
    display:flex;
    justify-content:center;
    gap:14px;
    flex-wrap:wrap;
    margin-top:10px;
  }

  button{
    border:0;
    border-radius:999px;
    padding:14px 22px;
    font-size:18px;
    cursor:pointer;
    box-shadow:0 10px 24px rgba(0,0,0,.12);
    transition: transform .12s ease, box-shadow .12s ease, opacity .2s ease;
    user-select:none;
    -webkit-tap-highlight-color: transparent;
  }
  button:active{ transform: translateY(1px) scale(.99); }

  #yesBtn{ background:#16a34a; color:white; }
  #noBtn{ background:#ef4444; color:white; position:relative; }

  .hint{
    margin-top:14px;
    font-size:13px;
    opacity:.65;
  }

  /* Fullscreen YES overlay button (more reliable than resizing the existing one) */
  #yesOverlay{
    position:fixed;
    inset:0;
    display:none;
    place-items:center;
    z-index:9999;
    background: radial-gradient(circle at 40% 30%, #fff1f2, #fb7185);
  }
  #yesOverlay.show{ display:grid; }
  #yesOverlay button{
    width:100%;
    height:100%;
    border-radius:0;
    font-size:clamp(40px,6vw,88px);
    box-shadow:none;
  }

  /* Floating hearts layer */
  #heartsLayer{
    position:fixed;
    inset:0;
    pointer-events:none;
    z-index:5;
  }
  .heart{
    position:absolute;
    font-size:18px;
    opacity:.85;
    will-change: transform, opacity;
    filter: drop-shadow(0 8px 10px rgba(0,0,0,.15));
  }

  /* Celebration layout */
  .wrap{
    width:min(980px, 96vw);
    background:rgba(255,255,255,.86);
    border-radius:24px;
    padding:22px;
    box-shadow:var(--shadow);
    backdrop-filter: blur(10px);
    text-align:center;
  }
  .big{
    margin:6px 0 10px;
    font-size:clamp(34px,6vw,72px);
    letter-spacing:-.02em;
  }

  .gif{
    width:min(760px, 92vw);
    max-height:52vh;
    object-fit:contain;
    border-radius:18px;
    box-shadow:0 14px 30px rgba(0,0,0,.18);
  }

  .msg{
    margin:12px auto 6px;
    font-size:18px;
    opacity:.9;
    max-width: 52ch;
  }

  /* Collage */
  .collage{
    margin:14px auto 0;
    width:min(920px, 94vw);
    display:grid;
    grid-template-columns: repeat(6, 1fr);
    gap:10px;
  }
  .tile{
    border-radius:16px;
    overflow:hidden;
    box-shadow:0 10px 22px rgba(0,0,0,.12);
    background: rgba(0,0,0,.04);
    aspect-ratio: 1 / 1;
  }
  .tile img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .tile.span2{ grid-column: span 2; }
  .tile.span3{ grid-column: span 3; }

  /* ‚ÄúPlan‚Äù modal */
  #planModal{
    position:fixed;
    inset:0;
    display:none;
    place-items:center;
    padding:22px;
    background: rgba(0,0,0,.45);
    z-index:10000;
  }
  #planModal.show{ display:grid; }
  .modal{
    width:min(720px, 94vw);
    background:rgba(255,255,255,.92);
    border-radius:22px;
    padding:20px 18px;
    box-shadow:0 24px 80px rgba(0,0,0,.25);
    text-align:left;
  }
  .modal h2{
    margin:0 0 10px;
    font-size:22px;
  }
  .modal p{ margin:0 0 12px; opacity:.85; }
  .modal ul{ margin:0 0 14px; padding-left:18px; }
  .modal li{ margin:8px 0; }
  .modalActions{
    display:flex;
    gap:10px;
    justify-content:flex-end;
    flex-wrap:wrap;
  }
  .btnSecondary{
    background:#111827;
    color:white;
  }
  .btnGhost{
    background:rgba(17,24,39,.08);
    color:#111827;
    box-shadow:none;
  }

  /* Confetti canvas */
  #confetti{
    position:fixed;
    inset:0;
    pointer-events:none;
    z-index:6;
  }

  /* accessibility */
  @media (prefers-reduced-motion: reduce){
    .screen{ transition:none; }
    .heart{ display:none; }
  }
</style>
</head>

<body>

<!-- Hearts + confetti layers -->
<div id="heartsLayer" aria-hidden="true"></div>
<canvas id="confetti" aria-hidden="true"></canvas>

<!-- YES fullscreen overlay -->
<div id="yesOverlay" aria-hidden="true">
  <button id="yesOverlayBtn" type="button">YES üíñ</button>
</div>

<!-- ASK SCREEN -->
<section id="askScreen" class="screen">
  <div class="card">
    <h1>Jo, will you be my valentine?</h1>
    <p class="subhead">You can say yes‚Ä¶ or you can try üòå</p>

    <div class="btnRow">
      <button id="yesBtn" type="button">Yes</button>
      <button id="noBtn" type="button">No</button>
    </div>

    <div class="hint">Tip: try clicking ‚ÄúNo‚Äù üëÄ</div>
  </div>
</section>

<!-- YES SCREEN -->
<section id="yesScreen" class="screen hidden">
  <div class="wrap">
    <div class="big">YES! LFG!! üí•üíñ</div>

    <!-- Replace the GIF URL if you want a different one -->
    <img class="gif"
      src="https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif"
      alt="Love explosion" />

    <!-- Personal message (edit this freely) -->
    <div class="msg">
      Happy Valentine‚Äôs Day, Jo. I‚Äôm taking you out‚Äîno takebacks üíå
    </div>

    <div class="btnRow" style="margin-top:14px;">
      <button id="planBtn" type="button" class="btnSecondary">See our plan for Valentine‚Äôs night</button>
      <button id="replayBtn" type="button" class="btnGhost">Replay</button>
    </div>

  </div>
</section>

<!-- PLAN MODAL -->
<div id="planModal" role="dialog" aria-modal="true" aria-labelledby="planTitle">
  <div class="modal">
    <h2 id="planTitle">Valentine‚Äôs Night Plan üíñ</h2>
    <p>Hope you're ready!.</p>
    <ul>
      <li><b>5:30 PM</b> ‚Äî Dinner reservation @ Parcelle Greenwich Village</li>
      <li><b>7:30 PM</b> ‚Äî Walk + dessert around West Village</li>
      <li><b>9:00 PM</b> ‚Äî Jazz Jazz Jazz</li>
    </ul>
    <div class="modalActions">
      <button id="closePlan" type="button" class="btnGhost">Close</button>
      <button id="okPlan" type="button" class="btnSecondary">Perfect</button>
    </div>
  </div>
</div>

<!-- Audio (starts after first user interaction; browsers block autoplay otherwise) -->
<audio id="bgm" preload="auto" loop>
  <!-- Replace with your own MP3 file name if you put it next to this HTML, e.g. "song.mp3" -->
  <source src="https://cdn.pixabay.com/download/audio/2022/02/23/audio_3a6a6aa5b0.mp3?filename=love-ambient-11084.mp3" type="audio/mpeg">
</audio>

<script>
/* -------------------------
   Robust behavior summary
   - NO: when approached (mouse or touch), disappears and YES overlay becomes the only option
   - YES: always works (either normal button or fullscreen overlay)
   - After YES: celebration screen + love effects + music (after gesture)
--------------------------*/

const askScreen = document.getElementById('askScreen');
const yesScreen = document.getElementById('yesScreen');

const yesBtn = document.getElementById('yesBtn');
const noBtn  = document.getElementById('noBtn');

const yesOverlay = document.getElementById('yesOverlay');
const yesOverlayBtn = document.getElementById('yesOverlayBtn');

const heartsLayer = document.getElementById('heartsLayer');
const confettiCanvas = document.getElementById('confetti');
const bgm = document.getElementById('bgm');

const planModal = document.getElementById('planModal');
const planBtn = document.getElementById('planBtn');
const closePlan = document.getElementById('closePlan');
const okPlan = document.getElementById('okPlan');
const replayBtn = document.getElementById('replayBtn');

let noTriggered = false;
let audioStarted = false;

/* ---- music: start only after a user gesture ---- */
async function startAudioOnce(){
  if (audioStarted) return;
  audioStarted = true;
  try{
    bgm.volume = 0.35;
    await bgm.play();
  }catch(e){
    // If blocked, keep it silent; user can tap again.
    audioStarted = false;
  }
}

/* ---- NO trap ---- */
function triggerYesOnlyMode(){
  if (noTriggered) return;
  noTriggered = true;

  // Hide NO button
  noBtn.style.opacity = '0';
  noBtn.style.pointerEvents = 'none';

  // Show full screen YES overlay (this avoids layout issues across browsers)
  yesOverlay.classList.add('show');
  yesOverlay.setAttribute('aria-hidden', 'false');

  // Start subtle hearts once the trap is triggered
  spawnHeartsBurst(16);
}

function isNearNoButton(clientX, clientY){
  const r = noBtn.getBoundingClientRect();
  const cx = r.left + r.width/2;
  const cy = r.top + r.height/2;
  const dx = clientX - cx;
  const dy = clientY - cy;
  const dist = Math.sqrt(dx*dx + dy*dy);
  // trigger when within ~90px of center (tune if you want)
  return dist < 90;
}

// Desktop: trigger on hover + also proximity for reliability
noBtn.addEventListener('pointerenter', triggerYesOnlyMode);
document.addEventListener('pointermove', (e) => {
  if (noTriggered) return;
  if (!noBtn || noBtn.style.pointerEvents === 'none') return;
  if (isNearNoButton(e.clientX, e.clientY)) triggerYesOnlyMode();
}, { passive:true });

// Mobile: touching NO triggers too
noBtn.addEventListener('touchstart', (e) => {
  e.preventDefault();
  triggerYesOnlyMode();
}, { passive:false });

/* ---- YES click handling ---- */
function goToYesScreen(){
  startAudioOnce();
  // hide overlay so it doesn't sit on top
  yesOverlay.classList.remove('show');
  yesOverlay.setAttribute('aria-hidden', 'true');

  // transition screens
  askScreen.classList.add('hidden');
  setTimeout(() => {
    yesScreen.classList.remove('hidden');
    // bigger celebration effects
    spawnHeartsBurst(30);
    launchConfetti(140);
  }, 280);
}

yesBtn.addEventListener('click', () => { startAudioOnce(); goToYesScreen(); });
yesOverlayBtn.addEventListener('click', () => { startAudioOnce(); goToYesScreen(); });

// Any first interaction should attempt to start audio (if you want it earlier)
document.addEventListener('pointerdown', startAudioOnce, { once:false, passive:true });

/* ---- Replay ---- */
replayBtn.addEventListener('click', () => {
  // reset state
  noTriggered = false;
  noBtn.style.opacity = '1';
  noBtn.style.pointerEvents = 'auto';
  yesOverlay.classList.remove('show');

  yesScreen.classList.add('hidden');
  askScreen.classList.remove('hidden');
});

/* ---- Plan modal ---- */
planBtn.addEventListener('click', () => {
  planModal.classList.add('show');
});
closePlan.addEventListener('click', () => planModal.classList.remove('show'));
okPlan.addEventListener('click', () => planModal.classList.remove('show'));
planModal.addEventListener('click', (e) => {
  if (e.target === planModal) planModal.classList.remove('show');
});
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') planModal.classList.remove('show');
});

/* -------------------------
   HEARTS ANIMATION
--------------------------*/
const HEARTS = ['üíñ','üíò','üíù','üíï','‚ù§Ô∏è'];
function spawnHeart(x, y){
  const el = document.createElement('div');
  el.className = 'heart';
  el.textContent = HEARTS[(Math.random()*HEARTS.length)|0];

  const startX = x ?? (Math.random() * window.innerWidth);
  const startY = y ?? (window.innerHeight + 20);

  const drift = (Math.random()*2 - 1) * 120;
  const rise =  (Math.random()*260) + 240;
  const dur =   (Math.random()*900) + 1200;

  el.style.left = startX + 'px';
  el.style.top  = startY + 'px';
  el.style.fontSize = (Math.random()*14 + 16) + 'px';

  heartsLayer.appendChild(el);

  const start = performance.now();
  function tick(now){
    const t = Math.min(1, (now - start) / dur);
    const ease = 1 - Math.pow(1 - t, 3);
    const xPos = startX + drift * ease;
    const yPos = startY - rise * ease;
    el.style.transform = `translate(${xPos - startX}px, ${yPos - startY}px) rotate(${(ease*90)}deg)`;
    el.style.opacity = String(1 - t);
    if (t < 1) requestAnimationFrame(tick);
    else el.remove();
  }
  requestAnimationFrame(tick);
}

function spawnHeartsBurst(n=18){
  const cx = window.innerWidth/2;
  const cy = window.innerHeight/2;
  for (let i=0;i<n;i++){
    const angle = (Math.PI * 2) * (i/n) + (Math.random()*0.5);
    const radius = 40 + Math.random()*80;
    spawnHeart(cx + Math.cos(angle)*radius, cy + Math.sin(angle)*radius);
  }
}

// gentle continuous float on yes screen
let floatTimer = null;
function startHeartsFloat(){
  if (floatTimer) return;
  floatTimer = setInterval(() => {
    if (!yesScreen.classList.contains('hidden')) spawnHeart();
  }, 220);
}
startHeartsFloat();

/* -------------------------
   CONFETTI (canvas)
--------------------------*/
function resizeConfetti(){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  confettiCanvas.width = Math.floor(window.innerWidth * dpr);
  confettiCanvas.height = Math.floor(window.innerHeight * dpr);
  confettiCanvas.style.width = window.innerWidth + 'px';
  confettiCanvas.style.height = window.innerHeight + 'px';
  const ctx = confettiCanvas.getContext('2d');
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener('resize', resizeConfetti);
resizeConfetti();

function launchConfetti(count=120){
  const ctx = confettiCanvas.getContext('2d');
  const W = window.innerWidth, H = window.innerHeight;

  const pieces = Array.from({length:count}, () => ({
    x: Math.random()*W,
    y: -20 - Math.random()*H*0.2,
    w: 4 + Math.random()*6,
    h: 6 + Math.random()*10,
    vx: (Math.random()*2 - 1) * 2.2,
    vy: 2.4 + Math.random()*3.8,
    rot: Math.random()*Math.PI,
    vr: (Math.random()*2 - 1) * 0.2,
    life: 0,
    max: 160 + Math.random()*120
  }));

  let rafId = null;
  function frame(){
    ctx.clearRect(0,0,W,H);
    for (const p of pieces){
      p.life++;
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      // slight sway
      p.vx += (Math.random()*2 - 1) * 0.03;

      // draw (no forced colors; use default black? better: randomized HSL but not specified by user.
      // We'll use a subtle randomized palette without setting specific named colors.)
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.globalAlpha = Math.max(0, 1 - p.life/p.max);
      ctx.fillStyle = `hsl(${(p.life*3 + p.x)%360} 85% 60%)`;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    }
    // stop when all expired
    const alive = pieces.some(p => p.life < p.max && p.y < H + 40);
    if (alive) rafId = requestAnimationFrame(frame);
    else { ctx.clearRect(0,0,W,H); cancelAnimationFrame(rafId); }
  }
  frame();
}
</script>
</body>
</html>
